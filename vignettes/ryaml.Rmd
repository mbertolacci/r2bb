---
title: "Using RYaml"
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Using RYaml}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(r2bb)
```

# Introduction

RYaml is a simple way to generate YAML files with embedded R code. It is a thin veneer over **rmarkdown**, so if you know how rmarkdown works you already know how RYaml works.

# YAML refresher

YAML is a plain ASCII format for nested key--value data. Nesting is represented by indentation so you can build up complex structures, not just a flat list of attributes. It's also the format used for the header of an rmarkdown file (the bit between the initial --- lines). See the [YAML web site](https://yaml.org/) for a thorough introduction.  You can create long text blocks using the | character:

```yaml
question_text: |
  This is a long block.
  You can write anything here, even *Markdown* if you want.
```
You nest values by indenting with spaces, for example:

```yaml
question:
  text: "What is 2 + 2?"
  answers:
    - 3
    - 4
```

Because YAML is just text, anything between the `|` and the next key is preserved exactly as written.

# What does RYaml add?

An RYaml file is simply a YAML file with rmarkdown code chunks. When you run `render_ryaml()`, those chunks are executed and the result is a plain YAML file. That means you can use R code to compute values, generate lists, or even print YAML directly.

## Example 1: Inline computed values

Here is an example of outputting a computed value to fill in a field in the YAML file:

````yaml
```{r, echo=FALSE}
dog_status <- 'great!'
```
animal: dog
how_good_are_dogs: `r dog_status`
````

When rendered to YAML, the output is:

```yaml
animal: dog
how_good_are_dogs: great!
```

You can render this to a YAML file using `render_ryaml("dogs.Ryaml", "dogs.yaml")`. Alternatively, you can call `read_ryaml` to read the YAML file into an R object:

```{r, eval = FALSE}
read_ryaml("dogs.Ryaml")
```

The output is a list with two elements:

```{r, echo = FALSE}
print(list(
  animal = 'dog',
  how_good_are_dogs = 'great!'
))
```


## Example 2: Computed YAML

Another way to generate YAML is to use the `yaml_print` function to convert the output of a code block directly to YAML. Here is a simple example:

````yaml
```{r, echo=FALSE}
# This block is echo = FALSE, so it does not appear in the rendered YAML
animal_names <- c("dog", "cat", "bird")
```
animal_names:
  ```{r, render = yaml_print, echo=FALSE, results='asis'}
  # Ensure that the code block has the right indentation to create valid YAML. Any expression printed
  # during this block will be rendered as YAML; to make valid YAML, you should only print one
  # value
  animal_names
  ```
````

The rendered YAML is:

```yaml
animal_names:
  - dog
  - cat
  - bird
```

We can call `read_ryaml` to read the YAML file into an R object:

```{r, eval = FALSE, echo = FALSE}
read_ryaml("animals.Ryaml")
```

```{r, echo = FALSE}
print(list(
  animal_names = c('dog', 'cat', 'bird')
))
```

This also works with more complex nested objects:

````yaml
```{r, echo=FALSE}
animal_info <- list(
  dog = list(
    name = 'dog',
    color = 'brown'
  )
)
```
animal_info:
  ```{r, render = yaml_print, echo=FALSE, results='asis'}
  animal_info
  ```
````

The rendered YAML is:

```yaml
animal_info:
  dog:
    name: dog
    color: brown
```

### Example 3: Markdown inside YAML

YAML text fields can contain Markdown. This lets you use RMarkdown to include code and its results. Here is an example:

````yaml
question_text: |
  Suppose the following code is run with the following output:

  ```{r}
  mean(1 : 10)
  ```

  What does this code do?
````

The rendered YAML is:

````yaml
question_text: |
  Suppose the following code is run with the following output:

  
  ``` r
  mean(1 : 10)
  ```
  
  ```
  ## [1] 5.5
  ```

  What does this code do?
````

# Embedded plots

By default RYaml will embed plots in the YAML file as base64-encoded images. This is useful if you want to include plots in your question. This seems to "just work" with Blackboard LMS, but your mileage may vary.

# Summary

RYaml lets you keep your question templates readable while still using R for computation. Remember that under the hood it's rmarkdown producing a YAML file, so anything rmarkdown can do—tables, plots, inline expressions—you can do inside an RYaml document.

